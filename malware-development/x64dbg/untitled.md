---
description: Windows API is for devs to use and hackers to abuse ;)
---

# Windows API

## Hacking w/ Windows API (Solid Reference)

{% embed url="https://www.ired.team/offensive-security/code-injection-process-injection" %}

This API is utilized to DIRECTLY interface with Windows. It is an interface that is available strictly within Windows.

## Windows MessageBox function \<winuser.h, windows.h>

{% embed url="https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-messagebox" %}

<mark style="color:yellow;">Want a message box in your application?</mark> Look no further.

Simply call `MessageBox()` and give it the int data type and that's it!

```c
int MessageBox()
```

This is pretty much the "Hello world" introduction to the Windows API!

What would this look like?

```c
#include <windows.h>

int main(void)
{

    MessageBoxW(NULL, L"This is a message box!", L"Hello WORLD!!!!", MB_YESNOCANCEL);
    
    return EXIT_SUCCESS;
}
```

## CreateRemoteThread() \<processthreadsapi.h>

Something that we can do that is malicious is utilize something found in the `processthreadsapi.h`, library known as the <mark style="color:yellow;">CreateRemotethread()</mark> function. With this, we can <mark style="color:yellow;">implement malicious techniques such as process injection</mark>.&#x20;

{% embed url="https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread" %}

Armed with that knowledge, we can create a <mark style="color:yellow;">RemoteThread</mark> to place our `MessageBox()` found above in a <mark style="color:green;">remote thread</mark>!

```c
#include <windows.h>

int main(void)
{

    MessageBoxW(NULL, L"This is a message box!", L"Hello WORLD!!!!", MB_YESNOCANCEL);
    
    return EXIT_SUCCESS;
    
    CreateRemoteThread();
    CreateRemoteThreadEx();
}
```

## CreateProcess CreateProcessW()

Not to be confused with `OpenProcess()`, `CreateProcess()` is literally the act of creating an entirely new process.&#x20;

The W means that it uses Wide instead of ansii.

So, with that said, let's create a new process!

{% embed url="https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessw" %}

```c
#include <windows.h>

/*BOOL CreateProcessW(
  [in, optional]      LPCWSTR               lpApplicationName,
  [in, out, optional] LPWSTR                lpCommandLine,
  [in, optional]      LPSECURITY_ATTRIBUTES lpProcessAttributes,
  [in, optional]      LPSECURITY_ATTRIBUTES lpThreadAttributes,
  [in]                BOOL                  bInheritHandles,
  [in]                DWORD                 dwCreationFlags,
  [in, optional]      LPVOID                lpEnvironment,
  [in, optional]      LPCWSTR               lpCurrentDirectory,
  [in]                LPSTARTUPINFOW        lpStartupInfo,
  [out]               LPPROCESS_INFORMATION lpProcessInformation
); */

int main(void)
{

STARTUPINFOW si = {0};
PROCESS_INFORMATION pi = {0};

  if

     (!CreateProcessW(L"C:\\Windows\\System32\\taskmanager.exe", NULL, NULL, NULL, FALSE, BELOW_NORMAL_PRIORITY_CLASS, NULL, NULL, &si, &pi))
     
    {
      
      printf("(-) Failed to create process, error: %ld", GetLasterror());
      return EXIT_FAILURE;
      
    }
    
  printf("(+) Process was successfully created and started!\n PID: %ld, pi.dwProcessId);
  return EXIT_SUCCESS;

}
```

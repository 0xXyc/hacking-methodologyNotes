---
description: 08/02/2025
---

# Payload Placement

## Motivation

There are several different locations where you can embed a payload within a Portable Executable (PE) file. Depending on your choice, it will reside within a different "section" within it. Payloads can be stored within the following PE sections:

* `.data`
* `.rdata`
* `.text`
* `.rsrc`
* _**Custom**_ (this can be a custom header/section that is added to a PE to store your shellcode or payload and can be done so using a tool like [PE-Bear](https://github.com/hasherezade/pe-bear))

### `.data` Section

The `.data` section of a PE file contains global and static variables declared within the source code. Once compiled (depending on compiler settings) into a PE binary, they are all conveniently stored within this dedicated section.&#x20;

#### Benefits

:white\_check\_mark: Since this section of the PE file is readable and writable (RW), it makes it a great place to store an encrypted payload that requires decryption during runtime.&#x20;

**Example:**

```cpp
unsigned char shellcode[] = {
 <shellcode_here>
}
```

Since we are storing our shellcode in a variable-declared buffer (`[ ]`), this is going to be stored in the `.data` section.

### `.rdata` Section

Variables specified using const are written as constants. These are considered read-only data, hence the r in .rdata. Any attempt to change these variables will lead to access violations.&#x20;

```cpp
const unsigned char shellcode[] = {
 <shellcode_here>
}
```

### Viewing Variables and Payloads in Raw Binary Format

We can use tools like `dumpbin.exe` and x86/x64dbg in order to view our payload in memory.

### `.rsrc` Section

By saving payloads within the `.rsrc` section, we can implement larger payloads collectively throughout our malware development journey.

#### How-To

1. Inside of Visual Studio, right-click on "Resource Files" -> "Add" -> "New Item"
2. Click on "Resource File"
3. It will then generate a new sidebar, known as the "Resource View". Right-click on the `.rc` file and select the "Add Resource" option
4. Click "Import"
5. EXAMPLE: Select the `calc.ico` file, which is the raw payload renamed to have the `.ico` extension
6. A prompt will appear requesting the resource type. Enter "RCDATA" without quotes
7. After clicking "OK", the payload should be displayed in raw binary format within the VS project
8. When exiting the "Resource View", the `resource.h` header file should be visible and named according to the `.rc` file from step 2. This file will contain a `define` statement that refers to the payload's ID in the resource section (`LDR_RCDATA1`). This is important in order to be able to retrieve the payload from the resource section later

<figure><img src="../../.gitbook/assets/image (257).png" alt=""><figcaption></figcaption></figure>

Once compiled, the \[TO BE CONTINUED].

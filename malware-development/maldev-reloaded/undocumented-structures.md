---
description: 04/21/2025
---

# ðŸš§ Undocumented Structures

These structures remain mostly undocumented in order to preserve the confidentiality and security of Windows and its users.&#x20;

This effort prevents users from being able to understand the structures and being able to modify members within them in order to manipulate the system.

With that said, it is crucial to be able to understand these structures as well as their corresponding elements within them.

**For example, let's take the Process Environment Block (`PEB`) Structure:**

```cpp
typedef struct _PEB {
BYTE Reserved1[2];
BYTE BeingDebugged;
BYTE Reserved2[1];
PVOID Reserved3[2];
PPEB_LDR_DATA Ldr;
PRTL_USER_PROCESS_PARAMETERS ProcessParameters;
PVOID Reserved4[3];
PVOID AtlThunkSListPtr;
PVOID Reserved5;
ULONG Reserved6;
PVOID Reserved7;
ULONG Reserved8;
ULONG AtlThunkSListPtr32;
PVOID Reserved9[45];
BYTE Reserved10[96];
PPS_POST_PROCESS_INIT_ROUTINE PostProcessInitRoutine;
BYTE Reserved11[128];
PVOID Reserved12[1];
ULONG SessionId;
} PEB, *PPEB;
```

See the `Reserved` elements? These are strategically undocumented elements to prevent users from being able to reverse engineer Windows and able to manipulate these structures to accomplish some goal (usually malicious).

Finding Reserved Members\
There are a few ways that we can go about discovering reserved members.

**These are:**

1. Using undocumentation sites
2. Relying on WinDbg to observe and determine what the PEB's reserved member's hold via the `!peb` command in WinDbg.

For example, the above `_PEB` struct is per the official Windows documentation. See how we can't see anything except for Windows Data Types and `Reserved` keywords?

Now, let's check on the results in `WinDbg` regarding the output of the `!peb` command:

```
0:025> !peb
PEB at 000000fa1031f000
InheritedAddressSpace: No <----------------------- Element 1
ReadImageFileExecOptions: No <----------------------- Element 1
BeingDebugged: Yes <----------------------- Definitely Element 2
ImageBaseAddress: 00007ff7cea40000 <----------------------- Element 3
NtGlobalFlag: 0
NtGlobalFlag2: 0
Ldr 00007fff1b608da0 <----------------------- Element 5
Ldr.Initialized: Yes
Ldr.InInitializationOrderModuleList: 000002e9dec04790 . 000002e981b63070
Ldr.InLoadOrderModuleList: 000002e9dec04920 . 000002e981b63050
Ldr.InMemoryOrderModuleList: 000002e9dec04930 . 000002e981b63060
```

### See where this is going??

Remember, we can refer to these attributes as elements or members; this is ambiguous and both terms are used throughout this series and all over the Internet.

## Alternative Documentation

As previously mentioned, some modules will avoid using Microsoft's documentation and instead use other documentation sources.

```
Process Hacker's Header Files -- https://github.com/winsiderss/systeminformer/tree/master/phnt/include

undocumented.ntinternals.net - Some structures may be outdated -- https://web.archive.org/web/20230401045934/http://undocumented.ntinternals.net/

ReactOS's Documentation -- https://doxygen.reactos.org/globals_type.html

Vergilius Project - Although mainly for Windows kernel structures, it remains a valuable resource. -- https://www.vergiliusproject.com/
```

## Things to be Mindful of:

* Some structures only work on a per-architecture-basis. As a result, ensure that the appropriate architecture and structure definition is chosen to abide by the architecture.
* In some cases, multiple structures may need to be defined in order to combat "nested structures". For example, structures such as the `PEB` structure may contain elements that are pointers to another structure.
  * Ultimately, it is super important to include the definitions of the latter structure to ensure it's correctly interpreted by the program.
* Only ONE version of the structures can exist at once (unless multi-architecture). One cannot use the "documented" Windows structure as well as the undocumented "reversed one" by the community.
  * As this will result in redefinition errors throughout the program during compilation
  * For example, if one was to include an undocumented PEB header as well as the documented (incomplete) Windows version located in `Winternl.h` file, it will result in these redefinition errors.
